---
import BaseLayout from '../layouts/BaseLayout.astro';
---

<BaseLayout
  title="Contact"
  description="Get in touch for consulting inquiries, collaboration ideas, or conversations about systems."
>
  <section class="section">
    <div class="container-narrow">
      <header class="mb-12">
        <p class="text-accent-amber font-sans text-small uppercase tracking-widest mb-4">
          Contact
        </p>
        <h1 class="text-h1 font-serif text-text-primary mb-6">
          Let's Connect
        </h1>
        <p class="text-body text-text-secondary">
          Whether you're looking for consulting help, have a collaboration idea, or just want
          to discuss systems thinking over coffee, I'd love to hear from you.
        </p>
      </header>

      <form
        class="space-y-6"
        action="/api/contact"
        method="POST"
        id="contact-form"
      >
        <!-- Honeypot field for spam protection -->
        <div class="hidden" aria-hidden="true">
          <label for="website">Website</label>
          <input type="text" id="website" name="website" tabindex="-1" autocomplete="off" />
        </div>

        <div>
          <label for="name" class="block text-text-primary text-small font-medium mb-2">
            Name
          </label>
          <input
            type="text"
            id="name"
            name="name"
            required
            class="w-full px-4 py-3 bg-garden-surface border border-garden-border rounded-lg text-text-primary placeholder:text-text-tertiary focus:border-accent-amber focus:outline-none transition-colors"
            placeholder="Your name"
          />
        </div>

        <div>
          <label for="email" class="block text-text-primary text-small font-medium mb-2">
            Email
          </label>
          <input
            type="email"
            id="email"
            name="email"
            required
            class="w-full px-4 py-3 bg-garden-surface border border-garden-border rounded-lg text-text-primary placeholder:text-text-tertiary focus:border-accent-amber focus:outline-none transition-colors"
            placeholder="you@example.com"
          />
        </div>

        <div>
          <label for="subject" class="block text-text-primary text-small font-medium mb-2">
            What brings you here?
          </label>
          <select
            id="subject"
            name="subject"
            class="w-full px-4 py-3 bg-garden-surface border border-garden-border rounded-lg text-text-primary focus:border-accent-amber focus:outline-none transition-colors"
          >
            <option value="consulting">Consulting inquiry</option>
            <option value="collaboration">Collaboration idea</option>
            <option value="conversation">Just want to chat</option>
            <option value="other">Something else</option>
          </select>
        </div>

        <div>
          <label for="message" class="block text-text-primary text-small font-medium mb-2">
            Message
          </label>
          <textarea
            id="message"
            name="message"
            required
            rows="6"
            class="w-full px-4 py-3 bg-garden-surface border border-garden-border rounded-lg text-text-primary placeholder:text-text-tertiary focus:border-accent-amber focus:outline-none transition-colors resize-none"
            placeholder="Tell me about your system, your challenge, or your idea..."
          ></textarea>
        </div>

        <button type="submit" class="btn-primary w-full">
          Send Message
        </button>
      </form>

      <p class="text-text-tertiary text-small text-center mt-8">
        Form submissions go to Cloudflare Workers. Your data stays private.
      </p>
    </div>
  </section>
</BaseLayout>

<script>
  const form = document.getElementById('contact-form') as HTMLFormElement;
  const button = form?.querySelector('button[type="submit"]') as HTMLButtonElement;
  const originalButtonText = button?.textContent || 'Send Message';

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();

    if (!button) return;

    // Show loading state
    button.disabled = true;
    button.textContent = 'Sending...';

    try {
      const formData = new FormData(form);

      const response = await fetch('/api/contact', {
        method: 'POST',
        body: formData,
      });

      const result = await response.json();

      if (response.ok && result.success) {
        // Show success message
        button.textContent = 'Message Sent!';
        button.classList.remove('bg-accent-amber', 'hover:bg-accent-terracotta');
        button.classList.add('bg-accent-sage');
        form.reset();

        setTimeout(() => {
          button.textContent = originalButtonText;
          button.classList.remove('bg-accent-sage');
          button.classList.add('bg-accent-amber', 'hover:bg-accent-terracotta');
          button.disabled = false;
        }, 3000);
      } else {
        throw new Error(result.error || 'Something went wrong');
      }
    } catch (error) {
      // Show error message
      button.textContent = 'Error - Try Again';
      button.classList.remove('bg-accent-amber', 'hover:bg-accent-terracotta');
      button.classList.add('bg-accent-terracotta');

      setTimeout(() => {
        button.textContent = originalButtonText;
        button.classList.remove('bg-accent-terracotta');
        button.classList.add('bg-accent-amber', 'hover:bg-accent-terracotta');
        button.disabled = false;
      }, 3000);
    }
  });
</script>
